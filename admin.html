<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - La Reina Aroma y Deco</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&family=Quicksand&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      background: #f8f5f2;
      margin: 0;
      padding: 0;
      color: #333;
    }
    /*body {
      font-family: 'Quicksand', sans-serif;
      background: url('images/background.jpg') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 0;
      color: #333;
    }*/
    header {
      background: #6b4c3b;
      color: #fff;
      padding: 2rem 1rem 1rem 1rem;
      text-align: center;
    }
    nav {
      background: #b48b6b;
      display: flex;
      justify-content: center;
      gap: 1rem;
      padding: 1rem 0;
    }
    nav button {
      background: #fff;
      color: #6b4c3b;
      border: none;
      border-radius: 5px;
      padding: 0.5rem 1.2rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    nav button.active,
    nav button:hover {
      background: #6b4c3b;
      color: #fff;
    }
    main {
      max-width: 700px;
      margin: 2rem auto;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      padding: 2rem;
    }
    h2 {
      color: #6b4c3b;
      margin-top: 0;
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }
    input[type="text"], textarea, input[type="file"], input[type="number"] {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.3rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
    }
    textarea {
      resize: vertical;
      min-height: 60px;
    }
    .producto-lista {
      margin-top: 2rem;
    }
    .producto-item {
      border-bottom: 1px solid #eee;
      padding: 1rem 0;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .producto-item img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    .acciones button {
      margin-right: 0.5rem;
      background: #b48b6b;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 0.4rem 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .acciones button:hover {
      background: #6b4c3b;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <h1>Panel de Administración</h1>
    <p>Gestiona la información del sitio</p>
  </header>
  <nav>
    <button id="nav-categorias" class="active" onclick="mostrarSeccion('categorias')">Categorías destacadas</button>
    <button id="nav-productos" onclick="mostrarSeccion('productos')">Productos por categoría</button>
    <button id="nav-carousel" onclick="mostrarSeccion('carousel')">Carrusel</button>
  </nav>
  <main>
    <!-- Categorías destacadas -->
    <section id="seccion-categorias">
      <h2>Agregar/Editar Categoría Destacada</h2>
      <form id="productoForm">
        <label for="nombre">Nombre de la categoría</label>
        <input type="text" id="nombre" required>

        <label for="descripcion">Descripción</label>
        <textarea id="descripcion" required></textarea>

        <label for="foto">Foto</label>
        <input type="file" id="foto" accept="image/*">

        <input type="hidden" id="productoId">

        <button type="submit">Guardar categoría</button>
      </form>

      <div class="producto-lista" id="productoLista">
        <h2>Categorías destacadas existentes</h2>
      </div>
    </section>

    <!-- Productos por categoría -->
    <section id="seccion-productos" class="hidden">
      <h2>Productos por Categoría</h2>
      <label for="categoriaSelect">Selecciona una categoría</label>
      <select id="categoriaSelect"></select>

      <form id="formProductoCategoria">
        <input type="hidden" id="productoCatId">
        <label for="nombreProd">Nombre del producto</label>
        <input type="text" id="nombreProd" required>

        <label for="descripcionProd">Descripción</label>
        <textarea id="descripcionProd" required></textarea>

        <label for="precioProd">Precio ($)</label>
        <input type="number" id="precioProd" min="0" step="0.01" required>

        <label for="fotoProd">Foto</label>
        <input type="file" id="fotoProd" accept="image/*">

        <button type="submit">Guardar producto</button>
      </form>

      <div class="producto-lista" id="listaProductosCategoria"></div>
    </section>

    <!-- Carrusel -->
    <section id="seccion-carousel" class="hidden">
      <h2>Imágenes del Carrusel</h2>
      <form id="carouselForm">
        <label for="carouselFoto">Imagen</label>
        <input type="file" id="carouselFoto" accept="image/*" required>
        <button type="submit">Agregar imagen</button>
      </form>
      <div class="producto-lista" id="carouselLista"></div>
    </section>
  </main>
  <script>
    // Navegador de secciones
    function mostrarSeccion(seccion) {
      document.getElementById('seccion-categorias').classList.add('hidden');
      document.getElementById('seccion-productos').classList.add('hidden');
      document.getElementById('seccion-carousel').classList.add('hidden');
      document.getElementById('nav-categorias').classList.remove('active');
      document.getElementById('nav-productos').classList.remove('active');
      document.getElementById('nav-carousel').classList.remove('active');
      if (seccion === 'categorias') {
        document.getElementById('seccion-categorias').classList.remove('hidden');
        document.getElementById('nav-categorias').classList.add('active');
      } else if (seccion === 'productos') {
        document.getElementById('seccion-productos').classList.remove('hidden');
        document.getElementById('nav-productos').classList.add('active');
      } else if (seccion === 'carousel') {
        document.getElementById('seccion-carousel').classList.remove('hidden');
        document.getElementById('nav-carousel').classList.add('active');
      }
    }

    // --- Categorías destacadas ---
    function getProductos() {
      return JSON.parse(localStorage.getItem('categoriasDestacadas') || '[]');
    }
    function setProductos(productos) {
      localStorage.setItem('categoriasDestacadas', JSON.stringify(productos));
    }

    function renderProductos() {
      const lista = document.getElementById('productoLista');
      const productos = getProductos();
      let html = '';
      if (productos.length === 0) {
        html = '<p>No hay categorías cargadas.</p>';
      } else {
        html = productos.map((prod, idx) => `
          <div class="producto-item">
            <img src="${prod.foto || ''}" alt="${prod.nombre}">
            <div>
              <strong>${prod.nombre}</strong>
              <p>${prod.descripcion}</p>
              <div class="acciones">
                <button type="button" onclick="editarProducto(${idx})">Editar</button>
                <button type="button" onclick="eliminarProducto(${idx})">Eliminar</button>
              </div>
            </div>
          </div>
        `).join('');
      }
      lista.innerHTML = '<h2>Categorías destacadas existentes</h2>' + html;
    }

    document.getElementById('productoForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const nombre = document.getElementById('nombre').value.trim();
      const descripcion = document.getElementById('descripcion').value.trim();
      const fotoInput = document.getElementById('foto');
      const productoId = document.getElementById('productoId').value;
      let fotoUrl = '';

      // Manejo de imagen (base64 para demo)
      if (fotoInput.files && fotoInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          fotoUrl = evt.target.result;
          guardarProducto(nombre, descripcion, fotoUrl, productoId);
        };
        reader.readAsDataURL(fotoInput.files[0]);
      } else {
        guardarProducto(nombre, descripcion, null, productoId);
      }
    });

    function guardarProducto(nombre, descripcion, fotoUrl, productoId) {
      let productos = getProductos();
      if (productoId) {
        // Editar
        productos[productoId] = {
          nombre,
          descripcion,
          foto: fotoUrl || productos[productoId].foto
        };
      } else {
        // Nuevo
        productos.push({ nombre, descripcion, foto: fotoUrl });
      }
      setProductos(productos);
      document.getElementById('productoForm').reset();
      document.getElementById('productoId').value = '';
      renderProductos();
    }

    window.editarProducto = function(idx) {
      const productos = getProductos();
      const prod = productos[idx];
      document.getElementById('nombre').value = prod.nombre;
      document.getElementById('descripcion').value = prod.descripcion;
      document.getElementById('productoId').value = idx;
      // No se puede precargar la imagen por seguridad del navegador
    };

    window.eliminarProducto = function(idx) {
      if (confirm('¿Eliminar esta categoría?')) {
        let productos = getProductos();
        productos.splice(idx, 1);
        setProductos(productos);
        renderProductos();
      }
    };

    renderProductos();

    // --- Productos por Categoría ---

    function getProductosPorCategoria() {
      return JSON.parse(localStorage.getItem('productosPorCategoria') || '{}');
    }
    function setProductosPorCategoria(obj) {
      localStorage.setItem('productosPorCategoria', JSON.stringify(obj));
    }

    // Actualiza el select de categorías
    function actualizarSelectCategorias() {
      const select = document.getElementById('categoriaSelect');
      const categorias = getProductos();
      select.innerHTML = categorias.map((cat, idx) =>
        `<option value="${cat.nombre}">${cat.nombre}</option>`
      ).join('');
    }

    // Renderiza los productos de la categoría seleccionada
    function renderProductosCategoria() {
      const categoria = document.getElementById('categoriaSelect').value;
      const lista = document.getElementById('listaProductosCategoria');
      const productosPorCategoria = getProductosPorCategoria();
      const productos = productosPorCategoria[categoria] || [];
      let html = '';
      if (productos.length === 0) {
        html = '<p>No hay productos en esta categoría.</p>';
      } else {
        html = productos.map((prod, idx) => `
          <div class="producto-item">
            <img src="${prod.foto || ''}" alt="${prod.nombre}">
            <div>
              <strong>${prod.nombre}</strong>
              <p>${prod.descripcion}</p>
              <p><b>Precio:</b> $${prod.precio || '0'}</p>
              <div class="acciones">
                <button type="button" onclick="editarProductoCategoria(${idx})">Editar</button>
                <button type="button" onclick="eliminarProductoCategoria(${idx})">Eliminar</button>
              </div>
            </div>
          </div>
        `).join('');
      }
      lista.innerHTML = html;
    }

    // Cuando cambia la categoría seleccionada, muestra sus productos
    document.getElementById('categoriaSelect').addEventListener('change', renderProductosCategoria);

    // Guardar producto por categoría
    document.getElementById('formProductoCategoria').addEventListener('submit', function(e) {
      e.preventDefault();
      const categoria = document.getElementById('categoriaSelect').value;
      const nombre = document.getElementById('nombreProd').value.trim();
      const descripcion = document.getElementById('descripcionProd').value.trim();
      const precio = document.getElementById('precioProd').value.trim();
      const fotoInput = document.getElementById('fotoProd');
      const productoCatId = document.getElementById('productoCatId').value;
      let productosPorCategoria = getProductosPorCategoria();
      let productos = productosPorCategoria[categoria] || [];

      function guardar(fotoUrl) {
        if (productoCatId) {
          productos[productoCatId] = {
            nombre,
            descripcion,
            precio,
            foto: fotoUrl || productos[productoCatId].foto
          };
        } else {
          productos.push({ nombre, descripcion, precio, foto: fotoUrl });
        }
        productosPorCategoria[categoria] = productos;
        setProductosPorCategoria(productosPorCategoria);
        document.getElementById('formProductoCategoria').reset();
        document.getElementById('productoCatId').value = '';
        renderProductosCategoria();
      }

      if (fotoInput.files && fotoInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          guardar(evt.target.result);
        };
        reader.readAsDataURL(fotoInput.files[0]);
      } else {
        guardar(null);
      }
    });

    // Editar producto por categoría
    window.editarProductoCategoria = function(idx) {
      const categoria = document.getElementById('categoriaSelect').value;
      const productos = getProductosPorCategoria()[categoria] || [];
      const prod = productos[idx];
      document.getElementById('nombreProd').value = prod.nombre;
      document.getElementById('descripcionProd').value = prod.descripcion;
      document.getElementById('precioProd').value = prod.precio || '';
      document.getElementById('productoCatId').value = idx;
      // No se puede precargar la imagen por seguridad del navegador
    };

    // Eliminar producto por categoría
    window.eliminarProductoCategoria = function(idx) {
      const categoria = document.getElementById('categoriaSelect').value;
      let productosPorCategoria = getProductosPorCategoria();
      let productos = productosPorCategoria[categoria] || [];
      if (confirm('¿Eliminar este producto?')) {
        productos.splice(idx, 1);
        productosPorCategoria[categoria] = productos;
        setProductosPorCategoria(productosPorCategoria);
        renderProductosCategoria();
      }
    };

    // --- Carrusel ---
    function getCarousel() {
      return JSON.parse(localStorage.getItem('carouselImgs') || '[]');
    }
    function setCarousel(arr) {
      localStorage.setItem('carouselImgs', JSON.stringify(arr));
    }
    function renderCarousel() {
      const lista = document.getElementById('carouselLista');
      const imgs = getCarousel();
      if (!lista) return;
      if (imgs.length === 0) {
        lista.innerHTML = '<p>No hay imágenes en el carrusel.</p>';
      } else {
        lista.innerHTML = imgs.map((img, idx) => `
          <div class="producto-item">
            <img src="${img}" alt="Imagen carrusel ${idx+1}">
            <div class="acciones">
              <button type="button" onclick="eliminarCarousel(${idx})">Eliminar</button>
            </div>
          </div>
        `).join('');
      }
    }
    document.getElementById('carouselForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const fotoInput = document.getElementById('carouselFoto');
      if (fotoInput.files && fotoInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          let imgs = getCarousel();
          imgs.push(evt.target.result);
          setCarousel(imgs);
          renderCarousel();
          fotoInput.value = '';
        };
        reader.readAsDataURL(fotoInput.files[0]);
      }
    });
    window.eliminarCarousel = function(idx) {
      let imgs = getCarousel();
      imgs.splice(idx, 1);
      setCarousel(imgs);
      renderCarousel();
    };
    renderCarousel();

    // Inicialización al mostrar la sección
    function inicializarProductosCategoria() {
      actualizarSelectCategorias();
      renderProductosCategoria();
    }

    // Si usas navegación por pestañas, llama a inicializarProductosCategoria() al mostrar la sección de productos
    // Por ejemplo, en tu función mostrarSeccion:
    const oldMostrarSeccion = window.mostrarSeccion;
    window.mostrarSeccion = function(seccion) {
      oldMostrarSeccion(seccion);
      if (seccion === 'productos') {
        inicializarProductosCategoria();
      }
    };
  </script>
</body>
</html>
